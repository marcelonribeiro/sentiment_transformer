schema: '2.0'
stages:
  scrape_news:
    cmd: python src/data/scraper.py --sitemap-folder data/raw/sitemaps_infomoney
      --days 30 --output data/raw/infomoney_news.csv
    deps:
    - path: data/raw/sitemaps_infomoney
      hash: md5
      md5: 2507d250b9c5f26eb6b3595be01dd22b.dir
      size: 7025460
      nfiles: 15
    - path: src/data/scraper.py
      hash: md5
      md5: 2cac39f4558805efc1427f263ea35f10
      size: 14243
      isexec: true
    outs:
    - path: data/raw/infomoney_news.csv
      hash: md5
      md5: 7e832cbff4e0f0fd0312e7be1d77b0ff
      size: 2712269
      isexec: true
  fetch_stock_codes:
    cmd: python src/data/get_stock_codes.py --output data/raw/stock_codes.json
    deps:
    - path: src/data/get_stock_codes.py
      hash: md5
      md5: 02a914b9382a5c489ed9a5d6cc1ee93d
      size: 3427
      isexec: true
    outs:
    - path: data/raw/stock_codes.json
      hash: md5
      md5: 1aa8cbd036d6b57752b3a51e75b421e9
      size: 7677
      isexec: true
  prepare_embeddings:
    cmd: python src/ml/convert_embeddings.py --input data/raw/cc.pt.300.vec 
      --output data/embeddings/cc.pt.300.bin
    deps:
    - path: data/raw/cc.pt.300.vec
      hash: md5
      md5: 1efd31465eff1091bf0f6cc5be3f7dcf
      size: 4520554048
      isexec: true
    - path: src/ml/convert_embeddings.py
      hash: md5
      md5: 346ed1c89536c69888203d0be6526699
      size: 2061
      isexec: true
    outs:
    - path: data/embeddings/cc.pt.300.bin
      hash: md5
      md5: 1721dfbb19dac1ea9047990e4ec9abd8
      size: 60607848
      isexec: true
    - path: data/embeddings/cc.pt.300.bin.vectors.npy
      hash: md5
      md5: 72d7bb9f1234f2fb52e088c301bb00b5
      size: 2400000128
      isexec: true
  process_data:
    cmd: python -m src.ml.process_data --input-csv data/raw/B2W-Reviews01.csv 
      --output-dir data/processed
    deps:
    - path: data/raw/B2W-Reviews01.csv
      hash: md5
      md5: 3d6bb9c7546fe32bb4dff53eaeedafda
      size: 49453175
      isexec: true
    - path: src/ml/process_data.py
      hash: md5
      md5: 4bc2e029d07f3a8932c09147e112ba5c
      size: 3130
      isexec: true
    outs:
    - path: data/processed
      hash: md5
      md5: 38d74288b2025b994e9fc74d8ab153bc.dir
      size: 10850135
      nfiles: 3
  train:
    cmd: python -m src.ml.train --train-csv data/processed/train.csv --val-csv 
      data/processed/val.csv --test-csv data/processed/test.csv --embeddings-bin
      data/embeddings/cc.pt.300.bin --artifacts-dir artifacts/training
    deps:
    - path: data/embeddings/cc.pt.300.bin
      hash: md5
      md5: 1721dfbb19dac1ea9047990e4ec9abd8
      size: 60607848
      isexec: true
    - path: data/processed
      hash: md5
      md5: 38d74288b2025b994e9fc74d8ab153bc.dir
      size: 10850135
      nfiles: 3
    - path: src/config.py
      hash: md5
      md5: 4538a1632e3d5e40899bc472e7c94fcc
      size: 1215
      isexec: true
    - path: src/ml/model_wrapper.py
      hash: md5
      md5: 6c3b7c7fc3b27eab10a8d29560cc2a8b
      size: 1568
      isexec: true
    - path: src/ml/train.py
      hash: md5
      md5: cafd89a87e02b2f060cfa8ca79bf7679
      size: 7859
      isexec: true
    - path: src/ml/transformer_layers.py
      hash: md5
      md5: 9346304db6f0564f11c7b1703967c075
      size: 8384
      isexec: true
    outs:
    - path: artifacts/training
      hash: md5
      md5: 6a1e7e08b15ab2b836ff4306f194d04c.dir
      size: 58000194
      nfiles: 6
  evaluate:
    cmd: python -m src.ml.evaluate --model-path 
      artifacts/training/sentiment_transformer.keras --test-dataset-path 
      artifacts/training/test_dataset_tf --test-labels-path 
      artifacts/training/test_labels.pkl --metrics-path metrics/scores.json 
      --cm-path metrics/confusion_matrix.png --roc-path metrics/roc_curve.png
    deps:
    - path: artifacts/training
      hash: md5
      md5: 6a1e7e08b15ab2b836ff4306f194d04c.dir
      size: 58000194
      nfiles: 6
    - path: src/ml/evaluate.py
      hash: md5
      md5: 10542d8d35890ab8192bebb63d1461bc
      size: 4049
      isexec: true
    - path: src/ml/transformer_layers.py
      hash: md5
      md5: 9346304db6f0564f11c7b1703967c075
      size: 8384
      isexec: true
    outs:
    - path: metrics/confusion_matrix.png
      hash: md5
      md5: 4c0aa7984768bcac7a7c0482f19d3444
      size: 21865
      isexec: true
    - path: metrics/roc_curve.png
      hash: md5
      md5: de979cf15fa59c0792a56288cb1fa0f6
      size: 38058
      isexec: true
    - path: metrics/scores.json
      hash: md5
      md5: ce92b81b47a7647d3b27dd4092f8099a
      size: 175
      isexec: true
  train_baseline:
    cmd: python -m src.ml.train_baseline --train-csv data/processed/train.csv 
      --val-csv data/processed/val.csv --test-csv data/processed/test.csv 
      --embeddings-bin data/embeddings/cc.pt.300.bin --artifacts-dir 
      artifacts/baseline
    deps:
    - path: data/embeddings/cc.pt.300.bin
      hash: md5
      md5: 1721dfbb19dac1ea9047990e4ec9abd8
      size: 60607848
      isexec: true
    - path: data/processed
      hash: md5
      md5: 38d74288b2025b994e9fc74d8ab153bc.dir
      size: 10850135
      nfiles: 3
    - path: src/config.py
      hash: md5
      md5: 4538a1632e3d5e40899bc472e7c94fcc
      size: 1215
      isexec: true
    - path: src/ml/model_wrapper.py
      hash: md5
      md5: 6c3b7c7fc3b27eab10a8d29560cc2a8b
      size: 1568
      isexec: true
    - path: src/ml/train_baseline.py
      hash: md5
      md5: d19d75843fb12122d33f255b2c87a301
      size: 7946
      isexec: true
    - path: src/ml/transformer_layers.py
      hash: md5
      md5: 9346304db6f0564f11c7b1703967c075
      size: 8384
      isexec: true
    outs:
    - path: artifacts/baseline
      hash: md5
      md5: 28547191d5febd51d59ae4b8ea7bb9c0.dir
      size: 40420304
      nfiles: 6
  evaluate_baseline:
    cmd: python -m src.ml.evaluate --model-path 
      artifacts/baseline/sentiment_transformer.keras --test-dataset-path 
      artifacts/baseline/test_dataset_tf --test-labels-path 
      artifacts/baseline/test_labels.pkl --metrics-path 
      metrics/baseline_scores.json --cm-path 
      metrics/baseline_confusion_matrix.png --roc-path 
      metrics/baseline_roc_curve.png
    deps:
    - path: artifacts/baseline
      hash: md5
      md5: 28547191d5febd51d59ae4b8ea7bb9c0.dir
      size: 40420304
      nfiles: 6
    - path: src/ml/evaluate.py
      hash: md5
      md5: 10542d8d35890ab8192bebb63d1461bc
      size: 4049
      isexec: true
    - path: src/ml/transformer_layers.py
      hash: md5
      md5: 9346304db6f0564f11c7b1703967c075
      size: 8384
      isexec: true
    outs:
    - path: metrics/baseline_confusion_matrix.png
      hash: md5
      md5: 416fc22445ce58363e1482600ba3578c
      size: 24679
      isexec: true
    - path: metrics/baseline_roc_curve.png
      hash: md5
      md5: ea796f3addb012f9966ce53639fd3e0f
      size: 40218
      isexec: true
    - path: metrics/baseline_scores.json
      hash: md5
      md5: 619bbcf06832f3d608190a5f65c9bc33
      size: 175
      isexec: true
  download_sitemaps:
    cmd: python src/data/scraper.py --action download --sitemap-folder 
      data/raw/sitemaps_infomoney
    deps:
    - path: src/data/scraper.py
      hash: md5
      md5: 2cacd86131156a6f2195c5f53f724331
      size: 15662
      isexec: true
    outs:
    - path: data/raw/sitemaps_infomoney
      hash: md5
      md5: 3f336a60a025f1d3833a162a45b840a6.dir
      size: 6233287
      nfiles: 14
  scrape_articles:
    cmd: python src/data/scraper.py --action scrape --sitemap-folder 
      data/raw/sitemaps_infomoney --days 30 --output data/raw/infomoney_news.csv
    deps:
    - path: data/raw/sitemaps_infomoney
      hash: md5
      md5: 3f336a60a025f1d3833a162a45b840a6.dir
      size: 6233287
      nfiles: 14
    - path: src/data/scraper.py
      hash: md5
      md5: 2cacd86131156a6f2195c5f53f724331
      size: 15662
      isexec: true
    outs:
    - path: data/raw/infomoney_news.csv
      hash: md5
      md5: 79976159ccf26f1a6aabaa989c50c7ae
      size: 2809230
      isexec: true
